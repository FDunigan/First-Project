<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB"
    crossorigin="anonymous">
    <!-- <link rel="stylesheet" type="text/css" href="assets/css/reset.css">
        <link rel="stylesheet" type="text/css" href="assets/css/style.css"> -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="https://www.gstatic.com/firebasejs/4.12.0/firebase.js"></script>
        <title>Watch While You Cook</title>
    </head>
    
    <body>
        <div class="container">
            <div class="jumbotron jumbotron-fluid">
                <h1 class="text-center">Watch While You Cook!</h1>
            </div>
            
            <div class="card">
                <h3 class="card-header">Make a Meal!</h3>
                <div class="card-body">
                    <form>
                        <div class="form-group">
                            <label for="mealName">Meal Name:</label>
                            <input type="name" class="form-control" id="mealName" placeholder="Steak and potatoes">
                        </div>
                        <div class="form-group">
                            <label for="mealCategory">Meal Category:</label>
                            <input type="category" class="form-control" id="mealCategory" placeholder="Beef">
                        </div>
                        <div class="form-group">
                            <label for="areaOrigin">Area of Origin:</label>
                            <input type="place" class="form-control" id="areaOrigin" placeholder="American">
                        </div>
                        <div class="form-group">
                            <label for="ingredients">Ingredients:</label>
                            <input type="ingredients" class="form-control" id="ingredients" placeholder="Olive oil, butter">
                        </div>
                        <button id="submit" type="submit" class="btn btn-primary">Submit</button>
                    </form>
                </div>
            </div>
            <br>
            
            <div class="row">
                
                <div class="col-md-12">
                    
                    
                    <div class="card mb-4">
                        <h3 class="card-header">Results</h3>
                        <div class="card-body">
                            <table class="table table-sm table-hover" id='results-table'>
                                <thead>
                                    <tr>
                                        <th scope="col">Meal Name</th>
                                    </tr>
                                </thead>
                                <tbody id="results-body">
                                </tbody>
                            </table>
                            
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row">
                
                <div class="col-md-12">
                    
                    <div class="card mb-4">
                        <h3 class="card-header">Ingredient List!</h3>
                        <div class="card-body">
                            
                            <table class="table table-sm table-hover" id='ingredient-table'>
                                <thead>
                                    <tr>
                                        <th scope="col">Meal Name</th>
                                        <th scope="col">Meal Category</th>
                                        <th scope="col">Area of Origin</th>
                                        <th scope="col">Ingredients</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script type="text/javascript">
            //Setting up some variables. Not sure if they need to be global, but it shouldn't hurt the script
            var categoryC = "";
            var categoryI = "";
            var categoryA = "";
            var categoryN = "";
            
            //function I dug up to help with handling filtering
            function counter(array, element) {
                var count = 0;
                for(var i = 0; i < array.length; ++i){
                    if(array[i] == element)
                    count++;
                }
                return count
            }
            
            //The function that runs when you submit a search
            $("#submit").on("click", function(){
                //Keeps it from submitting to a database
                event.preventDefault();
                //creates an array and pushes text field inputs into it
                var categoryArray = [];
                if ( $("#mealName").val().trim() != "") {
                    categoryN = "search.php?s=" + $("#mealName").val().trim();
                    categoryArray.push(categoryN);}
                    
                    if ( $("#mealCategory").val().trim() != "") {
                        categoryC = "filter.php?c=" + $("#mealCategory").val().trim();
                        categoryArray.push(categoryC)}
                        
                        if ( $("#ingredients").val().trim() != "") {
                            categoryI = "filter.php?i=" + $("#ingredients").val().trim();
                            categoryArray.push(categoryI)}
                            
                            if ( $("#areaOrigin").val().trim() != "") {
                                categoryA = "filter.php?a=" + $("#areaOrigin").val().trim();
                                categoryArray.push(categoryA)}
                                
                                console.log(categoryArray)
                                // setting up an array for filtering
                                var tempArray = [];
                                // Runs multiple GET methods for each query term
                                for (i=0; i<categoryArray.length; i++) {
                                    //Sets up the query Url
                                    var queryUrl = "https://www.themealdb.com/api/json/v1/1/" + categoryArray[i]
                                    console.log(queryUrl)
                                    //runs the GET method
                                    $.ajax({
                                        url: queryUrl,
                                        method: "GET"
                                    }).then(function(response) {
                                        console.log(response.meals);
                                        //Runs a for loop for each meal that comes up each time the GET method is run.
                                        $.each(response.meals, function(index, value) {
                                            //Pushes the meal into the array
                                            tempArray.push(value.strMeal)
                                            //checks to see how many copies of that meal are in the array
                                            var countNumber = counter(tempArray, value.strMeal)
                                            console.log(countNumber);
                                            //If the number of copies of that meal are equal to the number of GET methods run, then it suits all checked categories, and the meal is submitted to the table
                                            if (countNumber == categoryArray.length){
                                                var tr = $("<tr>")
                                                    var td = $("<td>")
                                                        var p = $("<p>")
                                                            $(p).text(value.strMeal)
                                                            console.log(p)
                                                            $(td).append(p).attr("database-id", value.idMeal).addClass("recipeLink");
                                                            $(tr).append(td);
                                                            $("#results-body").append(tr);  
                                                        }
                                                        else {
                                                            
                                                        }
                                                    });
                                                });
                                            }
                                            
                                            //Promise.all - give it an array of requests
                                            ;
                                        })
                                        
                                    </script>
                                </body>
                                </html>